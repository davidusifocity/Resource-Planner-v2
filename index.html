<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSU Resource Planner</title>
    <link href="https://fonts.googleapis.com/css2?family=Exo:wght@500;600;700;800&family=Lato:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="dashboard">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo">
                <h1>CSU RESOURCE PLANNER<span>Change Support Unit</span></h1>
                <div class="last-updated" id="lastUpdated">Last updated: --</div>
            </div>
            <nav class="nav-section">
                <div class="nav-label">OVERVIEW</div>
                <div class="nav-item active" data-page="dashboard">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg>
                    Dashboard
                </div>
                <div class="nav-item" data-page="pipeline">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg>
                    Work Backlog
                </div>
                <div class="nav-item" data-page="kanban">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="5" height="18" rx="1"/><rect x="10" y="3" width="5" height="12" rx="1"/><rect x="17" y="3" width="5" height="15" rx="1"/></svg>
                    Kanban View
                </div>
                <div class="nav-item" data-page="resources">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/></svg>
                    Resources
                </div>
            </nav>
            <nav class="nav-section">
                <div class="nav-label">ANALYSIS</div>
                <div class="nav-item" data-page="skills">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21.21 15.89A10 10 0 1 1 8 2.83"/><path d="M22 12A10 10 0 0 0 12 2v10z"/></svg>
                    Skills Matrix
                </div>
                <div class="nav-item" data-page="capacity">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>
                    Capacity
                </div>
            </nav>
            <div class="quick-stats">
                <div class="nav-label">QUICK STATS</div>
                <div class="stat-mini"><span class="stat-mini-label">Team Days/Wk</span><span class="stat-mini-value" id="sidebarDays">0</span></div>
                <div class="stat-mini"><span class="stat-mini-label">Avg Utilisation</span><span class="stat-mini-value amber" id="sidebarUtil">0%</span></div>
                <div class="stat-mini"><span class="stat-mini-label">Over-allocated</span><span class="stat-mini-value red" id="sidebarRisk">0</span></div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- DASHBOARD PAGE -->
            <div class="page-view active" id="page-dashboard">
                <header class="header">
                    <div class="header-left"><h2>Dashboard</h2><p>4-week rolling view</p></div>
                    <div class="header-actions">
                        <button class="btn" onclick="exportAllData()">Export All</button>
                        <button class="btn btn-primary" onclick="openWorkItemModal()">+ Work Item</button>
                    </div>
                </header>
                <div class="stats-grid">
                    <div class="stat-card"><div class="stat-label">Work Items</div><div class="stat-value" id="statWorkItems">0</div><div class="stat-sub">In progress or upcoming</div></div>
                    <div class="stat-card"><div class="stat-label">Team Days/Week</div><div class="stat-value" id="statDays">0</div><div class="stat-sub">Total available capacity</div></div>
                    <div class="stat-card"><div class="stat-label">Avg Utilisation</div><div class="stat-value" id="statLoad">0%</div><div class="stat-sub">Based on FTE allocation</div></div>
                    <div class="stat-card"><div class="stat-label">Over-allocated</div><div class="stat-value" id="statRisks">0</div><div class="stat-sub">Resources above 100%</div></div>
                </div>
                <div class="dashboard-grid">
                    <div class="card">
                        <div class="card-header"><span class="card-title">WORK BACKLOG</span><button class="card-action" onclick="navigateTo('pipeline')">â†’</button></div>
                        <div class="card-body">
                            <div class="pipeline-filters" id="dashboardFilters"></div>
                            <div class="pipeline-list" id="pipelineListDashboard"></div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header"><span class="card-title">UTILISATION HEATMAP</span><button class="card-action" onclick="navigateTo('capacity')">â†’</button></div>
                        <div class="card-body"><div class="heatmap-container"><table class="heatmap-table" id="heatmapTable"></table></div></div>
                    </div>
                    <div class="card">
                        <div class="card-header"><span class="card-title">ALLOCATION</span><button class="card-action" onclick="navigateTo('resources')">â†’</button></div>
                        <div class="card-body"><div class="allocation-list" id="allocationListDashboard"></div></div>
                    </div>
                    <div class="card">
                        <div class="card-header"><span class="card-title">CATEGORY COVERAGE</span><button class="card-action" onclick="navigateTo('skills')">â†’</button></div>
                        <div class="card-body">
                            <div class="category-legend"><span class="cap">Capacity</span><span class="dem">Demand</span></div>
                            <div class="category-coverage" id="categoryCoverage"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- BACKLOG PAGE -->
            <div class="page-view" id="page-pipeline">
                <header class="header">
                    <div class="header-left"><h2>Work Backlog</h2><p>All work items</p></div>
                    <div class="header-actions">
                        <button class="btn" onclick="downloadTemplate('workitems')">Template</button>
                        <button class="btn btn-primary" onclick="openWorkItemModal()">+ Work Item</button>
                    </div>
                </header>
                <div class="full-card">
                    <div class="card-header"><span class="card-title">ALL WORK</span></div>
                    <div class="card-body">
                        <div class="pipeline-filters" id="pipelineFiltersPage"></div>
                        <div class="pipeline-list" id="pipelineListPage"></div>
                    </div>
                </div>
            </div>

            <!-- KANBAN PAGE -->
            <div class="page-view" id="page-kanban">
                <header class="header">
                    <div class="header-left"><h2>Kanban View</h2><p>Work items by status</p></div>
                    <div class="header-actions">
                        <div class="pipeline-filters" id="kanbanFilters"></div>
                    </div>
                </header>
                <div class="kanban-container" id="kanbanContainer"></div>
            </div>

            <!-- RESOURCES PAGE -->
            <div class="page-view" id="page-resources">
                <header class="header">
                    <div class="header-left"><h2>Resources</h2><p>Team members and capacity</p></div>
                    <div class="header-actions">
                        <button class="btn" onclick="downloadTemplate('resources')">Template</button>
                        <button class="btn btn-primary" onclick="openResourceModal()">+ Add Resource</button>
                    </div>
                </header>
                <div class="resources-grid" id="resourcesGrid"></div>
            </div>

            <!-- SKILLS PAGE -->
            <div class="page-view" id="page-skills">
                <header class="header">
                    <div class="header-left"><h2>Skills Matrix</h2><p>Resource capabilities by work item category</p></div>
                    <div class="header-actions">
                        <button class="btn" onclick="downloadTemplate('skills')">Template</button>
                        <button class="btn btn-primary" onclick="openCategoryModal()">+ Add Category</button>
                    </div>
                </header>
                <div class="full-card">
                    <div class="card-header"><span class="card-title">0 = None Â· 1 = Basic Â· 2 = Developing Â· 3 = Competent Â· 4 = Advanced Â· 5 = Expert</span></div>
                    <div class="card-body">
                        <div class="skills-container"><table class="skills-table" id="skillsTable"></table></div>
                    </div>
                </div>
            </div>

            <!-- CAPACITY PAGE -->
            <div class="page-view" id="page-capacity">
                <header class="header">
                    <div class="header-left"><h2>Capacity Report</h2><p>FTE % utilisation per week</p></div>
                    <div class="header-actions"><button class="btn" onclick="exportCapacity()">Export CSV</button></div>
                </header>
                <div class="full-card">
                    <div class="card-header"><span class="card-title">WEEKLY UTILISATION (FTE %)</span></div>
                    <div class="card-body"><div class="heatmap-container"><table class="heatmap-table" id="heatmapTableFull"></table></div></div>
                </div>
            </div>
        </main>
    </div>

    <!-- WORK ITEM MODAL -->
    <div class="modal-overlay" id="workItemModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="wiModalTitle">New Work Item</h3>
                <button class="modal-close" onclick="closeModal('workItemModal')">Ã—</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="editWiId">
                <div class="form-group">
                    <label class="form-label">Title *</label>
                    <input type="text" class="form-input" id="wiTitle" placeholder="e.g. HR Dashboard Phase 2">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Portfolio Item</label>
                        <select class="form-select" id="wiPortfolioItem">
                            <option value="pstom">PSTOM</option>
                            <option value="integration">Integration</option>
                            <option value="strategic">Strategic</option>
                            <option value="adhoc">Ad-hoc</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Work Item Category</label>
                        <select class="form-select" id="wiCategory"></select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Size / Effort</label>
                        <select class="form-select" id="wiSize" onchange="updateEstimation()">
                            <option value="S">S â€“ Small</option>
                            <option value="M" selected>M â€“ Medium</option>
                            <option value="L">L â€“ Large</option>
                            <option value="XL">XL â€“ Extra Large</option>
                        </select>
                        <div class="form-hint" id="sizeHint">M = 7 effort days</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Duration (calendar days)</label>
                        <input type="number" class="form-input" id="wiDuration" value="20" min="1" max="260" step="1" oninput="updateEstimation()">
                        <div class="form-hint">Working days the item spans</div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Status</label>
                    <select class="form-select" id="wiStatus">
                        <option value="upcoming">Upcoming</option>
                        <option value="progress">In Progress</option>
                        <option value="blocked">Blocked</option>
                        <option value="complete">Complete</option>
                    </select>
                </div>

                <!-- Estimation Summary -->
                <div class="estimation-summary" id="estimationSummary">
                    <div class="estimation-row">
                        <span class="estimation-label">Effort Days</span>
                        <span class="estimation-value" id="estEffortDays">7</span>
                    </div>
                    <div class="estimation-row">
                        <span class="estimation-label">Duration</span>
                        <span class="estimation-value" id="estDuration">20 days</span>
                    </div>
                    <div class="estimation-row">
                        <span class="estimation-label">FTE % Required</span>
                        <span class="estimation-value estimation-highlight" id="estFTE">35%</span>
                    </div>
                </div>

                <!-- Resource Assignments -->
                <div class="form-group">
                    <label class="form-label">Resource Assignments</label>
                    <div class="effort-section">
                        <div class="effort-header">
                            <span>Assign resources â€” load splits evenly</span>
                            <button class="btn btn-small" onclick="addAssignmentRow()">+ Add Resource</button>
                        </div>
                        <div id="assignmentRows"></div>
                        <div class="effort-total">
                            <span class="effort-total-label">FTE % per person</span>
                            <span class="effort-total-value" id="ftePerPerson">--</span>
                        </div>
                    </div>
                </div>

                <div class="suggestions" id="suggestions">
                    <div class="suggestions-title">ðŸ’¡ Suggested Resources</div>
                    <div class="suggestion-list" id="suggestionList"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeModal('workItemModal')">Cancel</button>
                <button class="btn btn-primary" onclick="saveWorkItem()">Save</button>
            </div>
        </div>
    </div>

    <!-- RESOURCE MODAL -->
    <div class="modal-overlay" id="resourceModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="resModalTitle">New Resource</h3>
                <button class="modal-close" onclick="closeModal('resourceModal')">Ã—</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="editResId">
                <div class="form-group">
                    <label class="form-label">Role *</label>
                    <select class="form-select" id="resRole" onchange="updateAutoId()">
                        <option value="">-- Select Role --</option>
                        <option value="Change Manager">Change Manager</option>
                        <option value="Head of Change">Head of Change</option>
                        <option value="Project Manager">Project Manager</option>
                        <option value="Head of PMO">Head of PMO</option>
                        <option value="Project Analyst">Project Analyst</option>
                        <option value="Business Analyst">Business Analyst</option>
                        <option value="Project Support Officer">Project Support Officer</option>
                        <option value="Director of Change">Director of Change</option>
                    </select>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Auto-Generated ID</label>
                        <div class="auto-id-display">
                            <span class="auto-id-value" id="autoIdValue">--</span>
                            <span class="auto-id-hint">Based on role</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Name *</label>
                        <input type="text" class="form-input" id="resName" placeholder="e.g. David Chen">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Total FTE</label>
                        <input type="number" class="form-input" id="resFTE" step="0.1" value="1.0" min="0.1" max="1.0">
                        <div class="form-hint">1.0 FTE = 35 hrs/week = 5 days</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Baseline Commitment</label>
                        <input type="number" class="form-input" id="resBaseline" step="0.1" value="0" min="0" max="1.0">
                        <div class="form-hint">FTE reserved for BAU work</div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeModal('resourceModal')">Cancel</button>
                <button class="btn btn-primary" onclick="saveResource()">Save</button>
            </div>
        </div>
    </div>

    <!-- CATEGORY MODAL (Add / Edit) -->
    <div class="modal-overlay" id="categoryModal">
        <div class="modal" style="max-width:420px">
            <div class="modal-header">
                <h3 class="modal-title" id="catModalTitle">Add Work Item Category</h3>
                <button class="modal-close" onclick="closeModal('categoryModal')">Ã—</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="editCatOriginal">
                <div class="form-group">
                    <label class="form-label">Category Name</label>
                    <input type="text" class="form-input" id="newCategoryName" placeholder="e.g. Process Mapping">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeModal('categoryModal')">Cancel</button>
                <button class="btn btn-primary" id="catModalSaveBtn" onclick="saveCategory()">Add</button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>

    <!-- App Logic -->
    <script src="app.js" defer></script>
</body>
</html>
